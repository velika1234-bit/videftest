<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VideoQuiz Ultimate - Professional Edition</title>

    <!-- Tailwind CDN (—Å–∞–º–æ –∑–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Äì –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ—Ç–æ –µ –±–µ–∑–≤—Ä–µ–¥–Ω–æ) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide –∏–∫–æ–Ω–∏ -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞ Excel –∏ PDF -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.mini.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <!-- YouTube IFrame API (–≥–ª–æ–±–∞–ª–Ω–æ) -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- QR –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Å—Ç–∏–ª–æ–≤–µ -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-slate-50 min-h-screen">

    <!-- –õ–æ—É–¥—ä—Ä -->
    <div id="auth-loader" class="fixed inset-0 bg-white z-[999] flex flex-col items-center justify-center text-center p-6">
        <div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 font-black text-slate-400 uppercase text-[10px] tracking-widest">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞...</p>
        <button onclick="document.getElementById('auth-loader').classList.add('hidden')" class="mt-8 text-[9px] uppercase font-bold text-slate-300 underline">–í–ª–µ–∑ —Ä—ä—á–Ω–æ</button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞ —Å—ä–æ–±—â–µ–Ω–∏—è -->
    <div id="msg-container" class="fixed top-4 sm:top-8 left-1/2 -translate-x-1/2 z-[3000] w-full max-w-[280px] sm:max-w-sm px-4 pointer-events-none"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="app" class="max-w-7xl mx-auto p-3 sm:p-10">

        <!-- ========== –ï–ö–†–ê–ù–ò ========== -->

        <!-- Welcome Screen -->
        <div id="screen-welcome" class="py-4 sm:py-12 animate-pop">
            <header class="text-center mb-12 sm:mb-20">
                <h1 class="text-5xl sm:text-7xl md:text-9xl font-black mb-4 tracking-tighter text-slate-900 leading-none">VideoQuiz <span class="text-indigo-600">Pro</span></h1>
                <p class="text-slate-400 font-black uppercase tracking-[0.2em] text-[10px] sm:text-xs">Professional Cloud Edition</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 sm:gap-10">
                <div class="bg-white p-8 rounded-[3rem] border shadow-sm flex flex-col gap-6 text-center">
                    <h2 class="text-2xl font-black text-indigo-600">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–Ω–æ</h2>
                    <input type="text" id="ind-quiz-code" placeholder="–ö–æ–¥ –Ω–∞ —É—Ä–æ–∫" class="w-full p-4 bg-slate-50 rounded-2xl border-2 text-center font-bold outline-none">
                    <label for="ind-sop-mode" class="flex items-center justify-center gap-3 bg-indigo-50 border border-indigo-100 rounded-xl p-3 cursor-pointer">
                        <input type="checkbox" id="ind-sop-mode" class="w-5 h-5 accent-indigo-600">
                        <span class="text-xs font-black uppercase text-indigo-700">–°–û–ü —Ä–µ–∂–∏–º (–≥–ª–∞—Å–æ–≤ —á–µ—Ç–µ—Ü + –ø–æ-–µ–¥—ä—Ä —Ç–µ–∫—Å—Ç)</span>
                    </label>
                    <label for="ind-discussion-mode" class="flex items-center justify-center gap-3 bg-amber-50 border border-amber-200 rounded-xl p-3 cursor-pointer">
                        <input type="checkbox" id="ind-discussion-mode" class="w-5 h-5 accent-amber-600">
                        <span class="text-xs font-black uppercase text-amber-700">–†–µ–∂–∏–º –æ–±—Å—ä–∂–¥–∞–Ω–µ (–±–µ–∑ –∑–∞–ø–∏—Å –≤ –æ–±–ª–∞–∫–∞)</span>
                    </label>
                    <button onclick="window.startIndividual()" class="w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-700 transition-all text-xs shadow-indigo-200">–ó–∞–ø–æ—á–Ω–∏</button>
                </div>
                <div class="bg-white p-8 rounded-[3rem] border-2 border-emerald-500 shadow-2xl flex flex-col gap-6 text-center md:scale-105">
                    <h2 class="text-2xl font-black text-emerald-600">–í –ö–ª–∞—Å</h2>
                    <input type="text" id="live-student-name" placeholder="–¢–≤–æ–µ—Ç–æ –∏–º–µ" class="w-full p-4 bg-slate-50 rounded-2xl border-2 text-center font-bold outline-none">
                    <input type="text" id="live-pin" placeholder="PIN –∫–æ–¥" maxlength="4" inputmode="numeric" pattern="[0-9]*" class="w-full p-4 bg-slate-50 rounded-2xl border-2 text-center font-black text-2xl outline-none">
                    <button onclick="window.joinLiveSession()" class="w-full py-5 bg-emerald-500 text-white rounded-2xl font-black uppercase shadow-xl hover:bg-emerald-600 transition-all text-xs shadow-emerald-200">–í–ª–µ–∑ –≤ —Å–µ—Å–∏—è</button>
                </div>
                <div class="bg-slate-900 p-8 rounded-[3rem] shadow-2xl text-white flex flex-col gap-6 text-center">
                    <h2 class="text-2xl font-black text-indigo-400">–£—á–∏—Ç–µ–ª–∏</h2>
                    <p class="text-[10px] text-slate-400 uppercase font-black">–í—Ö–æ–¥ –∏ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</p>
                    <button onclick="window.switchScreen('teacher-auth')" class="mt-auto w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase text-xs">–í–ª–µ–∑ –≤ –ø–∞–Ω–µ–ª</button>
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div id="screen-teacher-dashboard" class="hidden animate-pop space-y-8">
            <div class="flex flex-col md:flex-row items-center justify-between bg-white p-6 sm:p-10 rounded-[3.5rem] border shadow-sm gap-6">
                <h2 class="text-2xl sm:text-4xl font-black text-slate-900 leading-none">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h2>
                <div class="flex flex-wrap gap-2 justify-center">
                    <button onclick="window.switchScreen('create')" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-indigo-100">+ –ù–æ–≤ –£—Ä–æ–∫</button>
                    <button onclick="window.openImportModal()" class="bg-emerald-500 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-emerald-100">–ò–º–ø–æ—Ä—Ç —Å –∫–æ–¥</button>
                    <button onclick="window.handleLogout()" class="bg-slate-100 text-slate-500 px-8 py-4 rounded-2xl font-black uppercase text-[10px]">–ò–∑—Ö–æ–¥</button>
                    <button id="admin-panel-btn" onclick="window.openAdminPanel()" class="hidden bg-purple-700 text-white px-8 py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-purple-200">üìä –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <h3 class="text-base font-black flex items-center gap-2 text-indigo-600 px-2"><i data-lucide="book-open"></i> –í–∞—à–∏—Ç–µ —É—Ä–æ—Ü–∏</h3>
                    <div id="my-quizzes-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar"></div>
                </div>
                <div class="space-y-4">
                    <h3 class="text-base font-black flex items-center gap-2 text-indigo-600 px-2"><i data-lucide="users"></i> –†–µ–∑—É–ª—Ç–∞—Ç–∏</h3>
                    <div class="flex items-center justify-between gap-3 px-2">
                        <p id="solo-results-summary" class="text-[11px] text-slate-400 font-bold">–í—Å–µ –æ—â–µ –Ω—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ —Ç–æ–∑–∏ –ø—Ä–æ—Ñ–∏–ª.</p>
                        <button onclick="window.exportSoloResultsExcel()" class="shrink-0 bg-indigo-600 text-white px-3 py-2 rounded-xl font-black uppercase text-[10px] shadow hover:bg-indigo-700 transition-all">–ï–∫—Å–ø–æ—Ä—Ç Excel</button>
                    </div>
                    <div class="bg-white rounded-[2.5rem] border shadow-sm h-[450px] overflow-hidden flex flex-col">
                        <div class="overflow-y-auto flex-1 custom-scrollbar">
                            <table class="w-full text-left">
                                <thead class="sticky top-0 bg-slate-50 font-black text-[9px] uppercase text-slate-400 border-b">
                                    <tr>
                                        <th class="py-4 px-4">–£—á–µ–Ω–∏–∫</th>
                                        <th class="py-4 px-4">–£—Ä–æ–∫</th>
                                        <th class="py-4 px-4">–î–∞—Ç–∞/–ß–∞—Å</th>
                                        <th class="py-4 px-4 text-right">–¢–æ—á–∫–∏</th>
                                        <th class="py-4 px-4 text-center">–ò–∑—Ç—Ä–∏–π</th>
                                    </tr>
                                </thead>
                                <tbody id="solo-results-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-100 p-4 rounded-2xl text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">–¢–µ–∫—É—â–æ ID (–í–∞—à–∏—è—Ç –ò–º–µ–π–ª/–ü—Ä–æ—Ñ–∏–ª): <span id="debug-uid" class="text-indigo-600 select-all">...</span></p>
            </div>
        </div>

        <!-- Teacher Auth Screen -->
        <div id="screen-teacher-auth" class="hidden py-10 animate-pop">
            <div class="max-w-md mx-auto bg-white p-10 rounded-[3rem] border shadow-2xl text-center space-y-6">
                <h2 class="text-2xl font-black" id="auth-title">–í—Ö–æ–¥ –∑–∞ –£—á–∏—Ç–µ–ª–∏</h2>

                <div class="space-y-4 text-left">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">–ò–º–µ–Ω–∞ (—Ç—Ä–∏ –∏–º–µ–Ω–∞)</label>
                        <input type="text" id="auth-name" class="w-full p-4 bg-slate-50 rounded-2xl border-2 font-bold outline-none text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">–ò–º–µ–π–ª</label>
                        <input type="email" id="auth-email" class="w-full p-4 bg-slate-50 rounded-2xl border-2 font-bold outline-none text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">–ü–∞—Ä–æ–ª–∞</label>
                        <input type="password" id="auth-password" class="w-full p-4 bg-slate-50 rounded-2xl border-2 font-bold outline-none text-sm">
                    </div>
                    <div id="auth-teacher-code-container" class="hidden">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-2">–°–µ–∫—Ä–µ—Ç–µ–Ω –ö–æ–¥ (—Å–∞–º–æ –∑–∞ —É—á–∏—Ç–µ–ª–∏)</label>
                        <input type="password" id="auth-teacher-code" placeholder="–ö–æ–¥..." class="w-full p-4 bg-indigo-50 border-2 border-indigo-100 rounded-2xl font-black text-center outline-none text-sm">
                    </div>
                </div>

                <button id="auth-submit-btn" onclick="window.handleAuthSubmit()" class="w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-700 transition-all text-sm">–í–ª–µ–∑</button>

                <p id="auth-toggle-text" class="text-xs text-slate-500" onclick="window.toggleAuthMode()">
                    –ù—è–º–∞—Ç–µ –∞–∫–∞—É–Ω—Ç? <span class="underline font-black cursor-pointer">–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π—Ç–µ —Å–µ</span>
                </p>

                <button onclick="window.switchScreen('welcome')" class="text-[10px] font-bold text-slate-400 uppercase mt-4">–ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- Creator View -->
        <div id="screen-create" class="hidden space-y-6 animate-pop">
            <div class="bg-white p-6 rounded-[3rem] border shadow-sm flex flex-col md:flex-row gap-4 items-center">
                <button onclick="window.switchScreen('teacher-dashboard')" class="p-5 bg-slate-50 rounded-2xl"><i data-lucide="arrow-left"></i></button>
                <input type="text" id="yt-url" placeholder="YouTube –ª–∏–Ω–∫..." class="flex-1 w-full p-5 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-indigo-600 outline-none font-bold">
                <div class="flex gap-2 w-full sm:w-auto">
                    <button onclick="window.loadEditorVideo()" class="flex-1 sm:flex-none bg-slate-900 text-white px-8 py-5 rounded-2xl font-black uppercase text-xs">–ó–∞—Ä–µ–¥–∏</button>
                    <button onclick="window.saveQuizToLibrary()" class="flex-1 sm:flex-none bg-indigo-600 text-white px-8 py-5 rounded-2xl font-black uppercase shadow-xl text-xs">–ó–∞–ø–∞–∑–∏</button>
                </div>
            </div>
            <div id="editor-view" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-8">
                    <div id="editor-player-container" class="video-container border-4 border-white shadow-2xl"></div>
                    <div class="mt-6 bg-white p-8 rounded-[3.5rem] flex flex-col sm:flex-row justify-between items-center border shadow-sm gap-6">
                        <div class="text-5xl sm:text-7xl font-black text-indigo-600" id="timer">00:00</div>
                        <button onclick="window.openQuestionModal()" class="w-full sm:w-auto bg-rose-500 text-white px-10 py-6 rounded-[2rem] font-black uppercase flex items-center justify-center gap-3 hover:scale-105 transition-all shadow-xl shadow-rose-100">
                            <i data-lucide="plus-circle"></i> –î–æ–±–∞–≤–∏ –≤—ä–ø—Ä–æ—Å
                        </button>
                    </div>
                </div>
                <div class="lg:col-span-4 bg-white rounded-[3rem] p-6 h-[550px] flex flex-col border shadow-sm overflow-hidden">
                    <h3 class="pb-3 border-b mb-4 font-black text-[10px] text-slate-400 uppercase tracking-widest text-center">–ù–∞—Å—Ç—Ä–æ–π–∫–∞</h3>
                    <div id="q-list" class="flex-1 overflow-y-auto custom-scrollbar space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Live Host View -->
        <div id="screen-live-host" class="hidden space-y-6 animate-pop">
            <div class="bg-indigo-600 p-8 rounded-[3rem] text-white flex justify-between items-center shadow-2xl shadow-indigo-100">
                <div>
                    <span class="text-[10px] font-black uppercase opacity-60">–ü–ò–ù:</span>
                    <div class="text-6xl font-black" id="host-pin">----</div>
                </div>
                <div class="flex gap-2 items-center">
                    <!-- –ë—É—Ç–æ–Ω–∏ –∑–∞ –µ–∫—Å–ø–æ—Ä—Ç (—Å–∫—Ä–∏—Ç–∏ –¥–æ –∫—Ä–∞—è –Ω–∞ —Å–µ—Å–∏—è—Ç–∞) -->
                    <div id="export-buttons-container" class="hidden gap-2">
                        <button onclick="window.exportExcel()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-4 rounded-xl font-black uppercase text-xs shadow-lg transition-all flex items-center gap-2"><i data-lucide="file-spreadsheet" class="w-4 h-4"></i> Excel</button>
                        <button onclick="window.exportPDF()" class="bg-slate-700 hover:bg-slate-800 text-white px-6 py-4 rounded-xl font-black uppercase text-xs shadow-lg transition-all flex items-center gap-2"><i data-lucide="file-text" class="w-4 h-4"></i> PDF</button>
                    </div>
                    <button onclick="window.finishLiveSession()" class="bg-rose-500 px-6 py-4 rounded-xl font-black uppercase text-xs shadow-lg">–ö—Ä–∞–π</button>
                    <button onclick="window.quitHostSession()" class="bg-white/10 px-6 py-4 rounded-xl font-black uppercase text-xs">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                <div class="lg:col-span-8">
                    <div id="host-player-area" class="hidden">
                        <!-- –ü—Ä–æ–≥—Ä–µ—Å –±–∞—Ä -->
                        <div class="mb-6 bg-white p-6 rounded-[2.5rem] shadow-xl shadow-indigo-50 border flex flex-col sm:flex-row items-center gap-6 relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-2 h-full bg-indigo-600"></div>
                            <div class="flex items-center gap-3 z-10">
                                <div class="p-3 bg-indigo-50 text-indigo-600 rounded-xl">
                                    <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-black text-slate-800 text-sm uppercase leading-none">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç</h3>
                                    <p id="progress-stats-text" class="text-[10px] font-bold text-slate-400 mt-1">–ù—è–º–∞ –¥–∞–Ω–Ω–∏</p>
                                    <p id="fastest-reaction-text" class="text-[10px] font-bold text-indigo-500 mt-1">‚ö° –ù–∞–π-–±—ä—Ä–∑ –æ—Ç–≥–æ–≤–æ—Ä: –Ω—è–º–∞ –¥–∞–Ω–Ω–∏</p>
                                </div>
                            </div>
                            <div class="flex-1 w-full bg-slate-100 h-8 rounded-full overflow-hidden shadow-inner relative">
                                <div id="class-progress-bar" class="w-full h-full flex transition-opacity duration-500 opacity-0">
                                    <div id="progress-correct" class="h-full bg-gradient-to-r from-emerald-400 to-emerald-600 flex items-center justify-end pr-2 transition-all duration-700 shadow-[0_0_20px_rgba(16,185,129,0.4)]"></div>
                                    <div id="progress-wrong" class="h-full bg-rose-400/20 transition-all duration-700"></div>
                                </div>
                            </div>
                            <div class="text-2xl font-black text-slate-800 z-10 min-w-[3.5rem] text-right" id="progress-percent">0%</div>
                        </div>
                        <div id="host-video-container" class="video-container border-4 border-white shadow-2xl rounded-[2.5rem]"></div>
                        <div class="mt-4 bg-white p-6 rounded-[2rem] shadow-sm border">
                            <div class="flex justify-between items-center">
                                <div class="text-5xl font-black text-indigo-600" id="host-timer">00:00</div>
                                <div id="participant-info" class="text-sm font-black text-slate-400 uppercase tracking-widest"><span id="host-participant-count">0</span> –£—á–∞—Å—Ç–Ω–∏—Ü–∏</div>
                            </div>
                        </div>
                    </div>
                    <div id="host-setup-area" class="bg-white p-12 rounded-[3rem] text-center shadow-sm border">
                        <button onclick="window.initHostPlayer()" class="w-full py-6 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl">–ó–∞–ø–æ—á–Ω–∏ –í–∏–¥–µ–æ—Ç–æ</button>
                    </div>
                </div>
                <!-- –î—è—Å–Ω–∞ –∫–æ–ª–æ–Ω–∞: –∫–ª–∞—Å–∏—Ä–∞–Ω–µ + QR –∫–æ–¥ -->
                <div class="lg:col-span-4 bg-white rounded-[3rem] flex flex-col border shadow-sm overflow-hidden min-h-full">
                    <div class="p-5 border-b font-black uppercase text-[10px] text-slate-500 text-center">–ö–ª–∞—Å–∏—Ä–∞–Ω–µ</div>
                    <div class="flex-1 overflow-y-auto p-3 custom-scrollbar">
                        <table class="w-full"><tbody id="host-results-body"></tbody></table>
                    </div>
                    <!-- QR –∫–æ–¥ –ø–æ–¥ –∫–ª–∞—Å–∏—Ä–∞–Ω–µ—Ç–æ (–ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ —Å–∫—Ä–∏—Ç) -->
                    <div id="qr-container" class="hidden p-3 border-t border-slate-200 flex flex-col items-center">
                        <div id="qr-code"></div>
                        <span class="text-[10px] font-bold text-slate-500 mt-1">–°–∫–∞–Ω–∏—Ä–∞–π –∑–∞ –±—ä—Ä–∑ –≤—Ö–æ–¥</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Solo Solving View -->
        <div id="screen-solve" class="hidden relative h-[85vh] overflow-hidden rounded-[3rem] bg-black shadow-2xl border-[8px] border-slate-900">
            <div id="solve-player-container" class="absolute inset-0"></div>
            <div id="ind-overlay" class="absolute inset-0 bg-slate-900/95 backdrop-blur-md hidden flex-col items-center justify-center p-6 z-[100] animate-pop text-center">
                <div class="max-w-3xl w-full space-y-10">
                    <h3 id="ind-overlay-q-text" class="text-xl sm:text-4xl font-black text-white leading-tight">...</h3>
                    <div id="ind-overlay-options" class="grid grid-cols-1 gap-4 w-full"></div>
                </div>
            </div>
        </div>

        <!-- Student View -->
        <div id="screen-live-client" class="hidden min-h-[70vh] flex flex-col items-center justify-center animate-pop p-4 text-center pb-32">
            <div id="client-waiting" class="space-y-8">
                <div class="w-32 h-32 bg-white rounded-[2.5rem] flex items-center justify-center mx-auto text-6xl shadow-2xl shadow-indigo-100 animate-bounce" id="my-avatar-display">üë§</div>
                <h2 id="waiting-status-text" class="text-xl sm:text-3xl font-black uppercase text-slate-800">–ò–∑—á–∞–∫–∞–π –≤—ä–ø—Ä–æ—Å...</h2>
            </div>
            <div id="client-question" class="hidden w-full max-w-2xl bg-white p-8 rounded-[3rem] shadow-2xl">
                <h3 id="live-q-text-client" class="text-lg sm:text-2xl font-black mb-10 leading-tight">...</h3>
                <div id="live-options-client" class="grid grid-cols-1 gap-3"></div>
            </div>
            <div id="client-finished" class="hidden bg-white p-12 rounded-[3rem] shadow-2xl text-center">
                <h2 class="text-2xl sm:text-4xl font-black">–ü—Ä–∏–∫–ª—é—á–∏!</h2>
                <div class="text-7xl font-black text-indigo-600 mt-4" id="final-score-display">0</div>
                <button onclick="location.reload()" class="w-full mt-8 py-4 bg-slate-900 text-white rounded-2xl font-black uppercase text-xs">–ù–∞—á–∞–ª–æ</button>
            </div>
        </div>

        <!-- Finish Result Screen -->
        <div id="screen-finish" class="hidden py-20 text-center animate-pop">
            <h2 class="text-3xl sm:text-6xl font-black text-slate-900 mb-6">–ë—Ä–∞–≤–æ! üéâ</h2>
            <div id="res-score" class="text-7xl sm:text-[10rem] font-black text-indigo-600 mb-10">0/0</div>
            <button onclick="location.reload()" class="py-5 px-16 bg-slate-900 text-white rounded-2xl font-black uppercase text-xs">–ù–∞—á–∞–ª–æ</button>
        </div>

        <!-- ========== –ú–û–î–ê–õ–ò ========== -->

        <!-- –ú–æ–¥–∞–ª –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ/—Ä–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –≤—ä–ø—Ä–æ—Å -->
        <div id="modal-q" class="fixed inset-0 bg-slate-900/95 backdrop-blur-xl hidden items-center justify-center p-4 z-[2000]">
            <div class="bg-white w-full max-w-xl rounded-[4rem] p-12 animate-pop flex flex-col gap-8 shadow-2xl max-h-[95vh] overflow-y-auto custom-scrollbar">
                <div class="flex items-center justify-between"><h2 class="text-2xl font-black" id="m-title-text">–ù–æ–≤ –≤—ä–ø—Ä–æ—Å</h2><span id="m-time" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-black text-sm">00:00</span></div>
                <div class="grid grid-cols-2 gap-4">
                    <select id="m-type" onchange="window.updateModalFields()" class="p-5 bg-slate-50 border-2 rounded-2xl font-black outline-none text-xs">
                        <option value="single">–ï–¥–∏–Ω –≤–µ—Ä–µ–Ω</option>
                        <option value="multiple">–ù—è–∫–æ–ª–∫–æ –≤–µ—Ä–Ω–∏</option>
                        <option value="boolean">–í—è—Ä–Ω–æ/–ù–µ–≤—è—Ä–Ω–æ</option>
                        <option value="open">–û—Ç–≤–æ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä</option>
                        <option value="ordering">–ü–æ–¥—Ä–µ–∂–¥–∞–Ω–µ</option>
                        <option value="timeline">üìÖ –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è (Timeline)</option>
                        <option value="numeric">–ß–∏—Å–ª–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä (–ø–ª—ä–∑–≥–∞—á)</option>
                        <option value="timeline-slider">üìÖ –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ–Ω –ø–ª—ä–∑–≥–∞—á (Timeline Slider)</option>
                    </select>
                    <input type="number" id="m-points" value="1" min="1" class="p-5 bg-slate-50 border-2 rounded-2xl font-black text-center text-xs">
                </div>
                <textarea id="m-text" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤—ä–ø—Ä–æ—Å —Ç—É–∫..." class="w-full p-6 bg-slate-50 rounded-2xl font-black border-2 outline-none text-sm resize-none" rows="3"></textarea>
                <div id="m-opts-container" class="space-y-3"></div>
                <button onclick="window.saveQuestion()" class="w-full bg-indigo-600 text-white py-6 rounded-2xl font-black shadow-2xl uppercase hover:bg-indigo-700 transition-all">–ó–∞–ø–∞–∑–∏</button>
                <button onclick="document.getElementById('modal-q').classList.add('hidden')" class="text-slate-400 font-black uppercase text-[10px] text-center">–û—Ç–∫–∞–∑</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª –∑–∞ —Å–ø–æ–¥–µ–ª—è–Ω–µ –Ω–∞ –∫–æ–¥ -->
        <div id="modal-share" class="fixed inset-0 bg-slate-900/90 backdrop-blur-xl hidden items-center justify-center p-4 z-[2500]">
            <div class="bg-white w-full max-w-lg rounded-[3rem] p-10 shadow-2xl animate-pop text-center space-y-8">
                <h2 class="text-xl font-black text-slate-900">–ö–æ–¥ –Ω–∞ —É—Ä–æ–∫–∞</h2>
                <textarea id="share-code-display" readonly class="w-full p-5 bg-slate-50 rounded-2xl border font-mono text-[10px] break-all h-32 outline-none shadow-inner"></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="window.copyShareCode()" class="bg-indigo-600 text-white py-5 rounded-2xl font-black uppercase shadow-xl text-[10px]">–ö–æ–ø–∏—Ä–∞–π</button>
                    <button onclick="document.getElementById('modal-share').classList.add('hidden')" class="bg-slate-100 text-slate-500 py-5 rounded-2xl font-black uppercase text-[10px]">–ó–∞—Ç–≤–æ—Ä–∏</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª –∑–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —É—Ä–æ–∫ -->
        <div id="modal-import" class="fixed inset-0 bg-slate-900/90 backdrop-blur-xl hidden items-center justify-center p-4 z-[2500]">
            <div class="bg-white w-full max-w-lg rounded-[3rem] p-10 shadow-2xl animate-pop text-center space-y-8">
                <h2 class="text-xl font-black text-slate-900">–ò–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –£—Ä–æ–∫</h2>
                <p class="text-xs text-slate-500">–ü–æ—Å—Ç–∞–≤–µ—Ç–µ –¥—ä–ª–≥–∏—è –∫–æ–¥ —Ç—É–∫:</p>
                <textarea id="import-code-input" placeholder="eyJ2Ijoi..." class="w-full p-5 bg-slate-50 rounded-2xl border font-mono text-[10px] h-32 outline-none shadow-inner resize-none"></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="window.submitImport()" class="bg-emerald-500 text-white py-5 rounded-2xl font-black uppercase shadow-xl text-[10px]">–ò–º–ø–æ—Ä—Ç–∏—Ä–∞–π</button>
                    <button onclick="document.getElementById('modal-import').classList.add('hidden')" class="bg-slate-100 text-slate-500 py-5 rounded-2xl font-black uppercase text-[10px]">–û—Ç–∫–∞–∑</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª –∑–∞ –ø–æ–º–æ—â –ø—Ä–∏ permission –≥—Ä–µ—à–∫–∏ -->
        <div id="modal-rules-help" class="fixed inset-0 bg-slate-900/95 backdrop-blur-xl hidden items-center justify-center p-4 z-[3000]">
            <div class="bg-white w-full max-w-2xl rounded-[3rem] p-8 md:p-12 animate-pop flex flex-col gap-6 shadow-2xl max-h-[95vh] overflow-y-auto custom-scrollbar relative">
                <button onclick="document.getElementById('modal-rules-help').classList.add('hidden')" class="absolute top-8 right-8 text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>

                <div class="text-center space-y-2">
                    <div class="w-20 h-20 bg-rose-100 text-rose-500 rounded-3xl flex items-center justify-center mx-auto text-4xl mb-4 animate-bounce">‚ö†Ô∏è</div>
                    <h2 class="text-3xl font-black text-slate-900">–î–æ—Å—Ç—ä–ø—ä—Ç –µ –æ—Ç–∫–∞–∑–∞–Ω</h2>
                    <p class="text-slate-500 font-bold">–ë–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏ –≤—ä–≤ Firebase –µ "–∑–∞–∫–ª—é—á–µ–Ω–∞".</p>
                </div>

                <div class="bg-slate-50 p-6 rounded-[2rem] border-2 border-indigo-100 space-y-4">
                    <h3 class="font-black text-indigo-600 uppercase text-xs tracking-widest">–ö–∞–∫ –¥–∞ –ø–æ–ø—Ä–∞–≤–∏—Ç–µ —Ç–æ–≤–∞ (—Å—Ç—ä–ø–∫–∞ –ø–æ —Å—Ç—ä–ø–∫–∞):</h3>
                    <ol class="list-decimal pl-5 space-y-2 text-sm font-bold text-slate-700">
                        <li>–û—Ç–≤–æ—Ä–µ—Ç–µ <a href="https://console.firebase.google.com/" target="_blank" class="text-indigo-600 underline">Firebase Console</a> –∏ –≤–ª–µ–∑—Ç–µ –≤—ä–≤ –≤–∞—à–∏—è –ø—Ä–æ–µ–∫—Ç.</li>
                        <li>–û—Ç–∏–¥–µ—Ç–µ –Ω–∞ <strong>Build</strong> -> <strong>Firestore Database</strong>.</li>
                        <li>–ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ —Ç–∞–±–∞ <strong>Rules</strong> (–≥–æ—Ä–µ –≤ —Å—Ä–µ–¥–∞—Ç–∞).</li>
                        <li>–ò–∑—Ç—Ä–∏–π—Ç–µ –≤—Å–∏—á–∫–æ —Ç–∞–º –∏ –ø–æ—Å—Ç–∞–≤–µ—Ç–µ —Ç–æ–∑–∏ –∫–æ–¥:</li>
                    </ol>
                    
                    <div class="relative group">
                        <pre class="bg-slate-900 text-slate-300 p-6 rounded-2xl font-mono text-xs overflow-x-auto select-all">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –û—Å–Ω–æ–≤–µ–Ω –ø—ä—Ç –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
    match /artifacts/videoquiz-ultimate-live {
      
      // 1. –ü–£–ë–õ–ò–ß–ù–ò –î–ê–ù–ù–ò (–°–µ—Å–∏–∏ –Ω–∞ –∂–∏–≤–æ)
      match /public/data/{document=**} {
        allow read, write: if true;
      }

      // 2. –î–ê–ù–ù–ò –ù–ê –£–ß–ò–¢–ï–õ–Ø (–õ–∏—á–Ω–∞ –ø–∞–ø–∫–∞)
      // –£—á–∏—Ç–µ–ª—è—Ç –∏–º–∞ –ø—ä–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª –Ω–∞–¥ –≤—Å–∏—á–∫–æ –≤ —Å–≤–æ—è—Ç–∞ –ø–∞–ø–∫–∞
      match /users/{userId}/{document=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // 3. –ò–ó–ö–õ–Æ–ß–ï–ù–ò–ï –ó–ê –†–ï–ó–£–õ–¢–ê–¢–ò (–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª–µ–Ω —Ä–µ–∂–∏–º)
      // –ü–æ–∑–≤–æ–ª—è–≤–∞–º–µ –Ω–∞ —É—á–µ–Ω–∏—Ü–∏—Ç–µ (–≤—Å–µ–∫–∏ –ª–æ–≥–Ω–∞—Ç, –≤–∫–ª. –∞–Ω–æ–Ω–∏–º–Ω–æ) –¥–∞ –ó–ê–ü–ò–°–í–ê —Ä–µ–∑—É–ª—Ç–∞—Ç
      match /users/{teacherId}/solo_results/{resultId} {
         allow create: if request.auth != null;
      }
    }
  }
}</pre>
                    </div>
                    
                    <p class="text-xs text-slate-400 text-center font-bold uppercase mt-2">–°–ª–µ–¥ —Ç–æ–≤–∞ –Ω–∞—Ç–∏—Å–Ω–µ—Ç–µ "Publish" –∏ –ø—Ä–µ–∑–∞—Ä–µ–¥–µ—Ç–µ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞.</p>
                </div>

                <button onclick="location.reload()" class="w-full py-5 bg-indigo-600 text-white rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-700 transition-all text-sm shadow-indigo-200">–ì–æ—Ç–æ–≤–æ, –ø—Ä–µ–∑–∞—Ä–µ–¥–∏!</button>
            </div>
        </div>

    </div>

    <!-- –ú–æ–¥—É–ª —Å —Ü—è–ª–∞—Ç–∞ –ª–æ–≥–∏–∫–∞ -->
    <script type="module" src="js/app.js"></script>

    <!-- –°–∫—Ä–∏–ø—Ç –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ PIN –æ—Ç QR –∫–æ–¥ -->
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const joinCode = urlParams.get('join');
            if (joinCode) {
                window.addEventListener('DOMContentLoaded', function() {
                    const pinInput = document.getElementById('live-pin');
                    if (pinInput) {
                        pinInput.value = joinCode;
                        setTimeout(() => {
                            document.getElementById('live-student-name').focus();
                        }, 100);
                    }
                });
            }
        })();
    </script>
</body>
</html>
